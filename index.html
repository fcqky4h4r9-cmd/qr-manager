<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QRç™»éŒ²ãƒ„ãƒ¼ãƒ«ï¼ˆWebç‰ˆï¼‰</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .qr-box { margin: 15px; }
  </style>
</head>
<body>

<h2>ğŸ“¦ QRç™»éŒ²ãƒ„ãƒ¼ãƒ«ï¼ˆGoogle Sheetsé€£æºï¼‰</h2>

<input type="text" id="itemName" placeholder="å“å"><br>
<input type="text" id="category" placeholder="ã‚«ãƒ†ã‚´ãƒª"><br>
<input type="text" id="model" placeholder="å‹ç•ª"><br>
<input type="text" id="place" placeholder="åˆæœŸé…ç½®"><br>

<button id="sendBtn">ç™»éŒ²ï¼‹QRç”Ÿæˆ</button>

<p id="status"></p>
<div id="qrArea"></div>

<script>
const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxJ3U6TegWtbBGIX4KCgGwOJvHJyA61f-Ezs8Ebho6cdCNIAG1gi5KkTGcqaQHI_3Rr/exec";

function uuid() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

document.getElementById("sendBtn").addEventListener("click", async () => {
  const name = document.getElementById("itemName").value;
  const category = document.getElementById("category").value;
  const model = document.getElementById("model").value;
  const place = document.getElementById("place").value;

  const QRID = uuid();
  const payload = { QRID, name, category, model, place };

  document.getElementById("status").innerText = "é€ä¿¡ä¸­â€¦";

  try {
    const res = await fetch(GAS_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const json = await res.json();
    console.log(json);

    document.getElementById("status").innerText = "é€ä¿¡å®Œäº†: " + QRID;

    const div = document.createElement("div");
    new QRCode(div, { text: `QRID=${QRID}`, width: 200, height: 200 });
    document.getElementById("qrArea").appendChild(div);

  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "é€ä¿¡å¤±æ•—ï¼ˆé€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼‰";
  }
});
</script>

</body>
</html>
